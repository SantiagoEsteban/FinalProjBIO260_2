---
title: "Untitled"
author: "Santiago Esteban"
date: "April 28, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Data collection

Our analysis required both, case count data for the 2014 Ebola outbreak in West Africa and also climate data for the same period (2013-2015) and region.

##Case count data
Weekly case counts since the beginning of the outbreak (December 2013) up until November 2015 were obtained from the WHO website on the 2014 Ebola virus outbreak (http://apps.who.int/gho/data/node.ebola-sitrep). Data for Guinea was available per prefecture (34 prefectures; no data for Mandiana). For Sierra Leone and Liberia case counts per district (Sierra Leone, 14 districts) and per county (Liberia, 15 counties) were retrieved. Only cases in the patient database were considered, both confirmed and probable. Probable cases are defined as patients suspected of having Ebola by a physician or deceased patients who died from "suspected" Ebola and had an epidemilogical link to a confirmed Ebola case; A case is classified as "confirmed" if they have a positive PCR-Ebola test.

##Climate data
Information on several climate factors was retrieved from the Climate Research Unit at the University of East Anglia (http://www.cru.uea.ac.uk/). Data for each climate factor was detailed in a grid with a definition of 0.5*0.5 degrees with monthly information. Climate factors include Vapor Pressure (hPa); Mean, Minimum and Maximum Temperature (degrees Celsius); Potential Evapotranspiration (mm per month); Precipitation (mm per month); Wet Day frequency (days per month) and Diurnal Temperature range (degrees Celsius). Data was available up until 2014.
The climate data grid was matched with each of the three countries sub-regions, averaging over the values for the total number of 0.5*0.5 degree squares that fitted into each region.
For the year 2015, no climate data was available, thus it was imputed as the mean of the four previous years. Also, since only monthly information was availble, weekly mean values were interpolated from the monthly data by means of a natural cubic spline function.

Finally information from both sources was combined in long format (LINK TO THE RMD for each country).

#Exploratory data analysis
Incidence 3 countries
```{r}
library(dplyr)
library(readr)
library(lubridate)
library(tidyr)
library(stringr)
library(ggplot2)
library(readxl)
library(ggmap)
library(RNetCDF)
library(xlsx)
library(ggmap)
library(sp)
library(gganimate)
library(ggrepel)
library(gridExtra)
library(RColorBrewer)

#Loading datasets created in previous step and adding information the peaks of onset
guinea_weekly_cases_climate <- read.csv('guinea_weekly_cases_climate.csv')
guinea_weekly_cases_climate$Weeks <- dmy(guinea_weekly_cases_climate$Weeks)
guinea_weekly_cases_climate <- group_by(guinea_weekly_cases_climate, Location) %>% mutate(Peak=ifelse(Total_cases>0 & Total_cases==max(Total_cases),1,0), Cum_peak=cumsum(Peak)) %>% ungroup


SL_weekly_cases_climate <- read.csv('SL_weekly_cases_climate.csv')
SL_weekly_cases_climate$Weeks <- ymd(SL_weekly_cases_climate$Weeks)
SL_weekly_cases_climate <- group_by(SL_weekly_cases_climate, Location) %>% mutate(Peak=ifelse(Total_cases>0 & Total_cases==max(Total_cases),1,0), Cum_peak=cumsum(Peak)) %>% ungroup

Liberia_weekly_cases_climate <- read.csv('Liberia_weekly_cases_climate.csv')
Liberia_weekly_cases_climate$Weeks <- dmy(Liberia_weekly_cases_climate$Weeks)
Liberia_weekly_cases_climate <- group_by(Liberia_weekly_cases_climate, Location) %>% mutate(Peak=ifelse(Total_cases>0 & Total_cases==max(Total_cases),1,0), Cum_peak=cumsum(Peak)) %>% ungroup

all_countries <- rbind(guinea_weekly_cases_climate, SL_weekly_cases_climate, Liberia_weekly_cases_climate)

```

Here we explore the total incidence and cumulative incidence by country.

```{r}
#Marginal incidence per country
guinea_marginal_incidence <- group_by(guinea_weekly_cases_climate, Weeks) %>% summarise(Total_cases=sum(Total_cases), country='Guinea')
Liberia_marginal_incidence <- group_by(Liberia_weekly_cases_climate, Weeks) %>% summarise(Total_cases=sum(Total_cases), country='Liberia')
SL_marginal_incidence <- group_by(SL_weekly_cases_climate, Weeks) %>% summarise(Total_cases=sum(Total_cases), country='Sierra Leone')
three_countries_marginal_incidence <- rbind(guinea_marginal_incidence, Liberia_marginal_incidence, SL_marginal_incidence)

ggplot() + 
    geom_area(data=filter(guinea_marginal_incidence, Weeks>'2013-12-01'), aes(x=Weeks, y=Total_cases, fill='Guinea'),color='black', alpha=0.5, size=0.5) + 
    geom_area(data=filter(Liberia_marginal_incidence, Weeks>'2013-12-01'), aes(x=Weeks, y=Total_cases, fill='Liberia'),color='black', alpha=0.5, size=0.5) + 
    geom_area(data=filter(SL_marginal_incidence, Weeks>'2013-12-01'), aes(x=Weeks, y=Total_cases, fill='Sierra Leone'), color='black', alpha=0.5, size=0.5) +
    scale_fill_discrete(name='Country') +
    guides(color="none") + ylab('Number of Cases') + ggtitle('Incidence of total cases vs Time') +
    theme_classic()

#Cumulative incidence per country
guinea_marginal_cumulative <- group_by(guinea_weekly_cases_climate, Weeks) %>% summarise(Total_cum=sum(Cum_cases), country='Guinea')
Liberia_marginal_cumulative <- group_by(Liberia_weekly_cases_climate, Weeks) %>% summarise(Total_cum=sum(Cum_cases), country='Liberia')
SL_marginal_cumulative <- group_by(SL_weekly_cases_climate, Weeks) %>% summarise(Total_cum=sum(Cum_cases), country='Sierra Leone')
three_countries_marginal_cumulative <- rbind(guinea_marginal_cumulative, Liberia_marginal_cumulative, SL_marginal_cumulative)


ggplot() +
    geom_area(data=filter(three_countries_marginal_cumulative, Weeks>'2013-12-01'), aes(x=Weeks, y=Total_cum, fill=country, color=country), alpha=0.6, size=1) +
    scale_fill_discrete(name='Country') + 
    guides(color = "none")+
    ylab('Cumulative number of cases') +
    ggtitle('Cumulative incidence')
```

Furthermore, we compare it to the average of the climate factors per country.

```{r}
#Min-Mean-Max temp
guinea_marginal_temp <- group_by(guinea_weekly_cases_climate, Weeks) %>% summarise(tmn=mean(tmn), tmp=mean(tmp), tmx=mean(tmx), country='Guinea')
Liberia_marginal_temp <- group_by(Liberia_weekly_cases_climate, Weeks) %>% summarise(tmn=mean(tmn), tmp=mean(tmp), tmx=mean(tmx), country='Liberia')
SL_marginal_temp <- group_by(SL_weekly_cases_climate, Weeks) %>% summarise(tmn=mean(tmn), tmp=mean(tmp), tmx=mean(tmx), country='Sierra Leone')
three_countries_marginal_climate <- rbind(guinea_marginal_temp, Liberia_marginal_temp, SL_marginal_temp)

#Vapor pressure
guinea_marginal_vap <- group_by(guinea_weekly_cases_climate, Weeks) %>% summarise(vap=mean(vap), country='Guinea')
Liberia_marginal_vap <- group_by(Liberia_weekly_cases_climate, Weeks) %>% summarise(vap=mean(vap), country='Liberia')
SL_marginal_vap <- group_by(SL_weekly_cases_climate, Weeks) %>% summarise(vap=mean(vap), country='Sierra Leone')
three_countries_marginal_climate <- left_join(three_countries_marginal_climate, rbind(guinea_marginal_vap, Liberia_marginal_vap, SL_marginal_vap), by=c('Weeks','country'))

#Precipitation
guinea_marginal_pre <- group_by(guinea_weekly_cases_climate, Weeks) %>% summarise(pre=mean(pre), country='Guinea')
Liberia_marginal_pre <- group_by(Liberia_weekly_cases_climate, Weeks) %>% summarise(pre=mean(pre), country='Liberia')
SL_marginal_pre <- group_by(SL_weekly_cases_climate, Weeks) %>% summarise(pre=mean(pre), country='Sierra Leone')
three_countries_marginal_climate <- left_join(three_countries_marginal_climate, rbind(guinea_marginal_pre, Liberia_marginal_pre, SL_marginal_pre), by=c('Weeks','country'))

#Creating graphs per measurement
three_countries_tmp <- ggplot(data=filter(three_countries_marginal_climate, Weeks>='2013-12-29'), aes(Weeks, tmp)) +
    geom_ribbon(aes(ymin=tmn, ymax=tmx), color='gray', alpha=0.2) + 
    geom_line(aes(y=tmp), color='red', size=0.8) + geom_line(aes(y=tmx), color='orange', size=0.2) +
    geom_line(aes(y=tmn), color='orange', size=0.2) + xlab('') + ylab('Min-Mean-Max\nTemp') + facet_grid(~country) 

three_countries_pre <- ggplot(data=filter(three_countries_marginal_climate, Weeks>='2013-12-29'), aes(Weeks)) + geom_area(aes(y=pre), color='light blue', size=1, fill='light blue', alpha=0.6) +
    geom_line(aes(y=pre), color='light blue')  + xlab('') + ylab('Precipitation\nin mm') + facet_grid(~country)+ theme(strip.background = element_blank(),   strip.text.x = element_blank())

three_countries_vap <- ggplot(data=filter(three_countries_marginal_climate, Weeks>='2013-12-29'), aes(Weeks)) + geom_area(aes(y=vap), size=1, fill='yellow', alpha=0.6) +
    geom_line(aes(y=vap), color='yellow') + xlab('') + ylab('Vapor pressure\nin hPa') + facet_grid(~country)+ theme(strip.background = element_blank(),   strip.text.x = element_blank())

three_countries_incidence <- ggplot(data=filter(three_countries_marginal_incidence, Weeks>='2013-12-29'), aes(Weeks)) + geom_area(aes(y=Total_cases), size=1, fill='light green', alpha=0.6) +
    geom_line(aes(y=Total_cases), color='light green') + xlab('') + ylab('Case count') + facet_grid(~country)+ theme(strip.background = element_blank(),   strip.text.x = element_blank())

three_countries_cumulative <- ggplot(data=filter(three_countries_marginal_cumulative, Weeks>='2013-12-29'), aes(Weeks)) + geom_area(aes(y=Total_cum), size=1, fill='orange', alpha=0.6) +
    geom_line(aes(y=Total_cum), color='orange') + xlab('') + ylab('Cumualtive case count') + facet_grid(~country)+ theme(strip.background = element_blank(),   strip.text.x = element_blank())

grid.arrange(three_countries_tmp, three_countries_pre, three_countries_vap, three_countries_incidence, three_countries_cumulative, nrow=5)
```

We can see that temperature has a downward trajectory in the weeks preceding the onset of the outbreak in all three countries. This is particularly the case for maximum temperature. It also coincides with the start of the rainy season. 


We visualize now the cumulative incidence per region for the three countries at the end of 2015 to see which were the most affected districts.


```{r}
#Creating dataframe with maps, climate and case count data.

#########
#Map data
#########

#Guinea
guineards <- readRDS("D:/Google Drive/Medicina/MPH/Courses/BIO 260/FinalProjBIO260_2/Guinea-Admin/GIN_adm2.rds")
guineashp.df <- fortify(guineards)
guinea_map <- as.data.frame(cbind(NAME_2=guineards@data$NAME_2, id=guineards@data$ID_2))
guinea_map$NAME_2 <- toupper(guinea_map$NAME_2)
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "BOKÉ", "BOKE")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "DINGUIRAYE", "DINGUIRAY")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "KÉROUANÉ", "KEROUANE")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "DUBRÉKA", "DUBREKA")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "FORÉCARIAH", "FORECARIAH")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "TÉLIMÉLÉ", "TELIMELE")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "LÉLOUMA", "LELOUMA")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "LABÉ", "LABE")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "TOUGUÉ", "TOUGUE")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "GUÉCKÉDOU", "GUECKEDOU")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "NZÉRÉKORÉ", "NZEREKORE")
guinea_map$NAME_2 <- str_replace_all(guinea_map$NAME_2, "YAMOU", "YOMOU")
guinea_map <- left_join(guineashp.df, guinea_map, by='id')
guinea_map <- rename(guinea_map, Location=NAME_2)
guinea_map_complete <- left_join(guinea_weekly_cases_climate, guinea_map, by='Location')
guineards_adm0 <- readRDS("D:/Google Drive/Medicina/MPH/Courses/BIO 260/FinalProjBIO260_2/Guinea-Admin/GIN_adm0.rds")
guineashp.adm0 <- fortify(guineards_adm0)

#Sierra Leone
SLrds <- readRDS("D:/Google Drive/Medicina/MPH/Courses/BIO 260/FinalProjBIO260_2/Guinea-Admin/SLE_adm2.rds")
SLshp.df <- fortify(SLrds)
SL_map <- as.data.frame(cbind(NAME_2=SLrds@data$NAME_2, id=SLrds@data$ID_2))
SL_map$NAME_2 <-str_replace(SL_map$NAME_2, "Western Urban", "WESTERNURBAN")
SL_map$NAME_2 <-str_replace(SL_map$NAME_2, "Western Rural", "WESTERNRURAL")
SL_map$NAME_2 <-str_replace(SL_map$NAME_2, "Port Loko", "PORTLOKO")
SL_map$NAME_2 <- toupper(SL_map$NAME_2)
SL_map <- left_join(SLshp.df, SL_map, by='id')
SL_map <- rename(SL_map, Location=NAME_2)
SL_map_complete <- left_join(SL_weekly_cases_climate, SL_map, by='Location')
SL_adm0_rds <- readRDS("D:/Google Drive/Medicina/MPH/Courses/BIO 260/FinalProjBIO260_2/Guinea-Admin/SLE_adm0.rds")
SLshp.adm0 <- fortify(SL_adm0_rds)
SL_map_complete$group <- as.factor(as.numeric(as.character(SL_map_complete$group))+100)

#Liberia
LBrds <- readRDS("D:/Google Drive/Medicina/MPH/Courses/BIO 260/FinalProjBIO260_2/Guinea-Admin/LBR_adm1.rds")
LBshp.df <- fortify(LBrds)
LB_map <- as.data.frame(cbind(Location=LBrds@data$NAME_1, id=LBrds@data$ID_1))
LB_map$Location <- toupper(LB_map$Location)
LB_map$Location <-str_replace(LB_map$Location, "GBAPOLU", "GBARPOLU")
LB_map$Location <-str_replace(LB_map$Location, "GRANDBASSA", "GRAND_BASSA")
LB_map$Location <-str_replace(LB_map$Location, "GRANDGEDEH", "GRAND_GEDEH")
LB_map$Location <-str_replace(LB_map$Location, "GRANDKRU", "GRAND_KRU")
LB_map$Location <-str_replace(LB_map$Location, "RIVER CESS", "RIVER_CESS")
LB_map$Location <-str_replace(LB_map$Location, "GRAND CAPE MOUNT", "GRAND_CAPE_MOUNT")
LB_map$Location <-str_replace(LB_map$Location, "RIVER GEE", "RIVER_GEE")
LB_map <- left_join(LBshp.df, LB_map, by='id')
LB_map_complete <- left_join(Liberia_weekly_cases_climate, LB_map, by='Location')
LB_adm0_rds <- readRDS("D:/Google Drive/Medicina/MPH/Courses/BIO 260/FinalProjBIO260_2/Guinea-Admin/LBR_adm0.rds")
LBshp.adm0 <- fortify(LB_adm0_rds)
LB_map_complete$group <- as.factor(as.numeric(as.character(LB_map_complete$group))+200)
```

##Cumulative incidence per region

We can clearly see that the highest number of cases were concentrated near the capitals of the three countries: Conakry (Conakry, Guinea), Freetown (Western Urban, Sierra Leone) and Monrovia (Montserrado, Liberia).
```{r}
mypalette<-brewer.pal(9,"Oranges")
 ggplot() +
    geom_polygon(data=filter(guinea_map_complete,count_week==152), aes(x = long, y = lat, group = group, fill = Cum_cases), color="black", size=0.25) + scale_fill_gradientn(name='Cumulative cases', colours = mypalette, values=c(0,0.05,0.1,0.2,0.3, 0.4, 0.5, 1)) +
geom_polygon(data=filter(SL_map_complete,count_week==152), aes(x = long, y = lat, group = group, fill = Cum_cases), color="black", size=0.25) +
    geom_polygon(data=filter(LB_map_complete,count_week==152), aes(x = long, y = lat, group = group, fill = Cum_cases), color="black", size=0.25)  +
    geom_polygon(aes(x = long, y = lat, group = group, color="Guinea"), fill=NA, size = 0.75, data=guineashp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Sierra Leone"), fill=NA, size = 0.75, data=SLshp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Liberia"), fill=NA, size = 0.75, data=LBshp.adm0) +
    geom_point(aes(x=-13.628, y=9.5876), color='blue', size=3) +
    geom_point(aes(x=-13.2317, y=8.4657), color='blue', size=3) +
    geom_point(aes(x=-10.7605, y=6.2907), color='blue', size=3) +
    geom_text(aes(x=-14.1784, y=9.6412, label='Conakry'), size=5) +
    geom_text(aes(x=-13.8317, y=8.4657, label='Freetown'), size=5) +
    geom_text(aes(x=-11.3605, y=6.2907, label='Monrovia'), size=5) +
    coord_map() + scale_color_discrete(name="Country") + theme_classic() +
        ggtitle('Cumulative case count by November 2015')
```

Nevertheless, as we can see in the animation below, the outbreak began near the junction of the three borders and expanded towards the main cities.

```{r}
three_countries_map_complete <- rbind(
    select(guinea_map_complete, count_week, Location, long, lat, group, Cum_cases, Total_cases, Peak, Weeks, Country) %>% filter(Weeks>'2013-12-01'),
    select(SL_map_complete, Location, count_week, long, lat, group, Cum_cases, Total_cases, Peak, Weeks,Country) %>% filter(Weeks>'2013-12-01'),
    select(LB_map_complete, Location, count_week, long, lat, group, Cum_cases, Total_cases, Peak, Weeks, Country) %>% filter(Weeks>'2013-12-01')
)

weeks_incidence <- seq(53,152, by=4)
three_countries_map_incidence <- ggplot(filter(three_countries_map_complete, count_week%in%weeks_incidence), aes(x = long, y = lat, group = group, fill = Cum_cases, frame=Weeks)) +
    geom_polygon(color = "black", size = 0.25) + coord_map() + scale_fill_gradientn(name='Cumulative case count', colours = mypalette, values=c(0,0.05,0.1,0.2,0.3, 0.4, 0.5, 1))

gg_animate(three_countries_map_incidence)

```

 Measurements for the three cities

```{r}
# #Long climate datafram for each capital
# conakry_data <- filter(guinea_weekly_cases_climate, Location=='CONAKRY') %>% select(-Month, -Year, -Country, -count_week) %>% gather(measurement, value, 2:11)
# 
# freetown_data <- filter(SL_weekly_cases_climate, Location=='WESTERNURBAN') %>% select(-Month, -Year, -Country, -count_week) %>% gather(measurement, value, 2:11)
# 
# monrovia_data <- filter(Liberia_weekly_cases_climate, Location=='MONTSERRADO') %>% select(-Month, -Year, -Country, -count_week) %>% gather(measurement, value, 2:11)
# 
# #Graphs per city
# #Conakry
# conakry_tmp <- ggplot(filter(guinea_weekly_cases_climate, Location=='CONAKRY', Weeks>'2013-12-01'), aes(Weeks)) + geom_ribbon(aes(ymin=tmn, ymax=tmx), color='gray', alpha=0.2) + 
#     geom_line(aes(y=tmp), color='red', size=0.8) + geom_line(aes(y=tmx), color='orange', size=0.2) +
#     geom_line(aes(y=tmn), color='orange', size=0.2) + theme_classic() + xlab('') + ylab('Min-Mean-Max\nTemp') + ggtitle('Conakry, Guinea')
# conakry_pre <- ggplot(filter(guinea_weekly_cases_climate, Location=='CONAKRY', Weeks>'2013-12-01'), aes(Weeks)) + geom_area(aes(y=pre), color='light blue', size=1, fill='light blue', alpha=0.6) +
#     geom_line(aes(y=pre), color='light blue') + theme_classic() + xlab('') + ylab('Precipitation\nin mm')
# conakry_vap <- ggplot(filter(guinea_weekly_cases_climate, Location=='CONAKRY', Weeks>'2013-12-01'), aes(Weeks)) + geom_area(aes(y=vap), fill='yellow', alpha=0.6) +
#     geom_line(aes(y=vap), color='yellow') + theme_classic() + xlab('') + ylab('Vapor pressure\nin hPa')
# conakry_incidence <- ggplot(filter(guinea_weekly_cases_climate, Location=='CONAKRY', Weeks>'2013-12-01'), aes(Weeks)) + geom_area(aes(y=Total_cases), fill='light green', alpha=0.6) +
#     geom_line(aes(y=Total_cases), color='light green') + theme_classic() + xlab('') + ylab('Case count')
# conakry_cumulative <- ggplot(filter(guinea_weekly_cases_climate, Location=='CONAKRY', Weeks>'2013-12-01'), aes(Weeks)) + geom_area(aes(y=Cum_cases), fill='orange', alpha=0.6) +
#     geom_line(aes(y=Cum_cases), color='orange') + theme_classic() + xlab('Week') + ylab('Cumulative cases')
# a <- grid.arrange(conakry_tmp, conakry_pre, conakry_vap, conakry_incidence, conakry_cumulative, nrow=5)

# ggplot(filter(conakry_data, measurement!='pet', measurement!='tmn', measurement!='tmx', measurement!='dtr', measurement!='wet', Weeks>='2013-12-29'), aes(x=Weeks, y=value)) + geom_area(alpha=0.4, aes(fill=measurement)) + geom_line(aes(color=measurement)) +
#     facet_grid(measurement~., scale='free', shrink=T, as.table = T) + theme(strip.background = element_blank(),   strip.text.y = element_blank()) +
#     scale_fill_discrete(name='Measurement', labels=c('Cum. cases','Precipitation','Mean temp.','Case count','Vapor pressure')) +
#     guides(color='none') + ggtitle('Conakry, Guinea')

loc <- c('CONAKRY', 'WESTERNURBAN','MONTSERRADO')
three_cities <-filter(all_countries, Location%in%loc, Weeks>='2013-12-29')

three_cities_tmp <- ggplot(three_cities, aes(Weeks, tmp)) +
    geom_ribbon(aes(ymin=tmn, ymax=tmx), color='gray', alpha=0.2) + 
    geom_line(aes(y=tmp), color='red', size=0.8) + geom_line(aes(y=tmx), color='orange', size=0.2) +
    geom_line(aes(y=tmn), color='orange', size=0.2) + xlab('') + ylab('Min-Mean-Max\nTemp') + facet_grid(~Location) 

three_cities_pre <- ggplot(three_cities, aes(Weeks)) + geom_area(aes(y=pre), color='light blue', size=1, fill='light blue', alpha=0.6) +
    geom_line(aes(y=pre), color='light blue')  + xlab('') + ylab('Precipitation\nin mm') + facet_grid(~Location)+ theme(strip.background = element_blank(),   strip.text.x = element_blank())

three_cities_vap <- ggplot(three_cities, aes(Weeks)) + geom_area(aes(y=vap), size=1, fill='yellow', alpha=0.6) +
    geom_line(aes(y=vap), color='yellow') + xlab('') + ylab('Vapor pressure\nin hPa') + facet_grid(~Location)+ theme(strip.background = element_blank(),   strip.text.x = element_blank())

three_cities_total <- ggplot(three_cities, aes(Weeks)) + geom_area(aes(y=Total_cases), size=1, fill='light green', alpha=0.6) +
    geom_line(aes(y=Total_cases), color='light green') + xlab('') + ylab('Case count') + facet_grid(~Location)+ theme(strip.background = element_blank(),   strip.text.x = element_blank())

three_cities_cum <- ggplot(three_cities, aes(Weeks)) + geom_area(aes(y=Cum_cases), size=1, fill='orange', alpha=0.6) +
    geom_line(aes(y=Cum_cases), color='orange') + xlab('') + ylab('Cumualtive case count') + facet_grid(~Location)+ theme(strip.background = element_blank(),   strip.text.x = element_blank())

grid.arrange(three_cities_tmp, three_cities_pre, three_cities_vap, three_cities_total, three_cities_cum, nrow=5)

# #Freetown
# freetown_climate <- filter(SL_weekly_cases_climate, Location=='WESTERNURBAN', Weeks>'2013-12-01')
# freetown_tmp <- ggplot(freetown_climate, aes(Weeks)) + geom_ribbon(aes(ymin=tmn, ymax=tmx), color='gray', alpha=0.2) + 
#     geom_line(aes(y=tmp), color='red', size=0.8) + geom_line(aes(y=tmx), color='orange', size=0.2) +
#     geom_line(aes(y=tmn), color='orange', size=0.2) + theme_classic() + xlab('') + ggtitle('Freetown, Sierra Leone') + ylab('') 
# 
# freetown_pre <- ggplot(freetown_climate, aes(Weeks)) + geom_area(aes(y=pre), color='light blue', size=1, fill='light blue', alpha=0.6) +
#     geom_line(aes(y=pre), color='light blue') + theme_classic() + xlab('') + ylab('')
# 
# freetown_vap <- ggplot(freetown_climate, aes(Weeks)) + geom_area(aes(y=vap), fill='yellow', alpha=0.6) +
#     geom_line(aes(y=vap), color='yellow') + theme_classic() + xlab('') + ylab('')
# 
# freetown_incidence <- ggplot(freetown_climate, aes(Weeks)) + geom_area(aes(y=Total_cases), fill='light green', alpha=0.6) +
#     geom_line(aes(y=Total_cases), color='light green') + theme_classic() + xlab('') + ylab('')
# 
# freetown_cumulative <- ggplot(freetown_climate, aes(Weeks)) + geom_area(aes(y=Cum_cases), fill='orange', alpha=0.6) +
#     geom_line(aes(y=Cum_cases), color='orange') + theme_classic() + xlab('Week') + ylab('')
# 
# b <- grid.arrange(freetown_tmp, freetown_pre, freetown_vap, freetown_incidence, freetown_cumulative, nrow=5)
# 
# # ggplot(filter(freetown_data, measurement!='pet', measurement!='tmn', measurement!='tmx', measurement!='dtr', measurement!='wet', Weeks>='2013-12-29'), aes(x=Weeks, y=value)) + geom_area(alpha=0.4, aes(fill=measurement)) + geom_line(aes(color=measurement)) +
# #     facet_grid(measurement~., scale='free', shrink=T, as.table = T) + theme(strip.background = element_blank(),   strip.text.y = element_blank()) +
# #     scale_fill_discrete(name='Measurement', labels=c('Cum. cases','Precipitation','Mean temp.','Case count','Vapor pressure')) +
# #     guides(color='none') + ggtitle('Freetown, Sierra Leone')
# 
# #Monrovia
# monrovia_climate <- filter(Liberia_weekly_cases_climate, Location=='MONTSERRADO', Weeks>'2013-12-01')
# monrovia_tmp <- ggplot(monrovia_climate, aes(Weeks)) + geom_ribbon(aes(ymin=tmn, ymax=tmx), color='gray', alpha=0.2) + 
#     geom_line(aes(y=tmp), color='red', size=0.8) + geom_line(aes(y=tmx), color='orange', size=0.2) +
#     geom_line(aes(y=tmn), color='orange', size=0.2) + theme_classic() + xlab('') + ggtitle('Monrovia, Liberia') + ylab('') 
# 
# monrovia_pre <- ggplot(monrovia_climate, aes(Weeks)) + geom_area(aes(y=pre), color='light blue', size=1, fill='light blue', alpha=0.6) +
#     geom_line(aes(y=pre), color='light blue') + theme_classic() + xlab('') + ylab('')
# 
# monrovia_vap <- ggplot(monrovia_climate, aes(Weeks)) + geom_area(aes(y=vap), fill='yellow', alpha=0.6) +
#     geom_line(aes(y=vap), color='yellow') + theme_classic() + xlab('') + ylab('')
# 
# monrovia_incidence <- ggplot(monrovia_climate, aes(Weeks)) + geom_area(aes(y=Total_cases), fill='light green', alpha=0.6) +
#     geom_line(aes(y=Total_cases), color='light green') + theme_classic() + xlab('') + ylab('')
# 
# monrovia_cumulative <- ggplot(monrovia_climate, aes(Weeks)) + geom_area(aes(y=Cum_cases), fill='orange', alpha=0.6) +
#     geom_line(aes(y=Cum_cases), color='orange') + theme_classic() + xlab('Week') + ylab('')
# 
# c <- grid.arrange(monrovia_tmp, monrovia_pre, monrovia_vap, monrovia_incidence, monrovia_cumulative, nrow=5)
# 
# grid.arrange(a,b,c, ncol=3)

# ggplot(filter(monrovia_data, measurement!='pet', measurement!='tmn', measurement!='tmx', measurement!='dtr', measurement!='wet', Weeks>='2013-12-29'), aes(x=Weeks, y=value)) + geom_area(alpha=0.4, aes(fill=measurement)) + geom_line(aes(color=measurement)) +
#     facet_grid(measurement~., scale='free', shrink=T, as.table = T) + theme(strip.background = element_blank(),   strip.text.y = element_blank()) +
#     scale_fill_discrete(name='Measurement', labels=c('Cum. cases','Precipitation','Mean temp.','Case count','Vapor pressure')) +
#     guides(color='none') + ggtitle('Monrovia, Liberia\nMeasurement vs Time')
```

Climate of reference weeks (summer, fall, winter, spring), for the three countries.

```{r}
three_countries_map_climate <- rbind(
    select(guinea_map_complete, Location, count_week, long, lat, group, tmp, pre, vap, Weeks, Country) %>% filter(Weeks>'2013-12-01'),
    select(SL_map_complete, Location, count_week, long, lat, group, tmp, pre, vap, Weeks,Country) %>% filter(Weeks>'2013-12-01'),
    select(LB_map_complete, Location, count_week, long, lat, group, tmp, pre, vap, Weeks, Country) %>% filter(Weeks>'2013-12-01'))

#Mean Temp
ggplot(three_countries_map_climate %>% 
           filter(count_week==53 | count_week==65 | count_week==77|count_week==89)
       , aes(x = long, y = lat, group = group, fill = tmp)) +
    geom_polygon(color = "black", size = 0.25) + scale_fill_gradient(low='yellow', high='red',name='Mean Temperature\nin degrees Celsius') +
    geom_polygon(aes(x = long, y = lat, group = group, color="Guinea"), fill=NA, size = 0.75, data=guineashp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Sierra Leone"), fill=NA, size = 0.75, data=SLshp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Liberia"), fill=NA, size = 0.75, data=LBshp.adm0) +
    coord_map() + scale_color_discrete(name="Country")+ facet_wrap(~Weeks) + theme_classic() +
    ggtitle('Mean Temperatures per region, Year 2014')

#Precipitation
ggplot(three_countries_map_climate %>% 
           filter(count_week==53 | count_week==65 | count_week==77|count_week==89)
       , aes(x = long, y = lat, group = group, fill = pre)) +
    geom_polygon(color = "black", size = 0.25) + scale_fill_gradient(low='light blue', high='dark blue',name='Preciptiation\nin mm/week') +
    geom_polygon(aes(x = long, y = lat, group = group, color="Guinea"), fill=NA, size = 0.75, data=guineashp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Sierra Leone"), fill=NA, size = 0.75, data=SLshp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Liberia"), fill=NA, size = 0.75, data=LBshp.adm0) +
    coord_map() + scale_color_discrete(name="Country")+ facet_wrap(~Weeks) + theme_classic()+
    ggtitle('Mean Precipitation per region, Year 2014')

#Vapor pressure
ggplot(three_countries_map_climate %>% 
           filter(count_week==53 | count_week==65 | count_week==77|count_week==89)
       , aes(x = long, y = lat, group = group, fill = vap)) +
    geom_polygon(color = "black", size = 0.25) + scale_fill_gradient(low='green', high='yellow',name='Vapor pressure\nin hPa') +
    geom_polygon(aes(x = long, y = lat, group = group, color="Guinea"), fill=NA, size = 0.75, data=guineashp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Sierra Leone"), fill=NA, size = 0.75, data=SLshp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Liberia"), fill=NA, size = 0.75, data=LBshp.adm0) +
    coord_map() + scale_color_discrete(name="Country")+ facet_wrap(~Weeks) + theme_classic()+
    ggtitle('Vapor Pressure per region, Year 2014')
```

Peaks

```{r}
weeks_count <- c(60,80,100,120,140,150)
ggplot(data=filter(three_countries_map_complete, Peak==1 & count_week%in%weeks_count), aes(x = long, y = lat, group = group), fill="red") +
    geom_polygon(color = "black", size = 0.25) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Guinea"), fill=NA, size = 0.75, data=guineashp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Sierra Leone"), fill=NA, size = 0.75, data=SLshp.adm0) +
    geom_polygon(aes(x = long, y = lat, group = group, color="Liberia"), fill=NA, size = 0.75, data=LBshp.adm0) +
    coord_map() +facet_wrap(~Weeks)


```

PEAKS, MONTHLY, do by country the 3 column graph.